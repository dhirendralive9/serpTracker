<%- include('partials/navbar') %>

<div class="container mt-5">
    <a href="/dashboard" class="btn btn-secondary mb-3">&larr; Go Back</a>

    <h2>Keyword Stats: "<%= keyword.keyword %>"</h2>

    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Date</th>
                <th>Rank</th>
            </tr>
        </thead>
        <tbody id="historyTable">
            <% history.slice(0, limit).forEach(entry => { %>
                <tr>
                    <td><%= entry.checkedAt ? new Date(entry.checkedAt).toLocaleString() : "N/A" %></td>

                    <td><%= entry.position %></td>
                </tr>
            <% }) %>
        </tbody>
    </table>

    <div class="d-flex justify-content-between">
        <% if (page > 1) { %>
            <a href="?page=<%= page - 1 %>&limit=<%= limit %>" class="btn btn-primary">Previous</a>
        <% } %>
        <% if (page < totalPages) { %>
            <a href="?page=<%= page + 1 %>&limit=<%= limit %>" class="btn btn-primary">Next</a>
        <% } %>
    </div>

    <div class="mt-3">
        <label>Results per page:</label>
        <select id="paginationLimit" class="form-select w-auto">
            <option value="10" selected>10</option>
            <option value="50">50</option>
            <option value="100">100</option>
        </select>
    </div>
</div>

<script>
document.getElementById("paginationLimit").addEventListener("change", function() {
    window.location.href = "?page=1&limit=" + this.value;
});
</script>
<script>
    function formatDate(isoDate) {
        const dateObj = new Date(isoDate);
        if (isNaN(dateObj.getTime())) return "Invalid Date";
    
        const options = { year: 'numeric', month: '2-digit', day: '2-digit', 
                          hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
        return dateObj.toLocaleString("en-GB", options).replace(",", ""); // Ensures correct formatting
    }
    </script>
